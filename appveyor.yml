version: 1.0.{build}

branches:
  only:
    - master
environment:
  nodejs_version: "6"

install:
  - npm install
  - npm install elm -g 
  - npm install webpack -g 
  - elm-package install --yes
  - ps: $fileContent = "-----BEGIN RSA PRIVATE KEY-----`n"
  - ps: $fileContent += $env:priv_key.Replace(' ', "`n")
  - ps: $fileContent += "`n-----END RSA PRIVATE KEY-----`n"
  - ps: Set-Content c:\users\appveyor\.ssh\id_rsa $fileContent

build_script:
  - webpack --config webpack.config.prod.js

on_success:
  - cd dist
  - git init
  - git add -A
  - git commit -m 'New release'
  - git remote add deploy ssh://ci@46.101.41.13/code/sensor-frontend
  - git push deploy master